---
title: "ArgoCD Email Alerts: A Step-by-Step Guide for Real-Time Monitoring"
seoTitle: "Real-Time Monitoring with ArgoCD Email Alerts"
seoDescription: "Learn how to set up ArgoCD email alerts for real-time monitoring of your Kubernetes clusters with this step-by-step guide"
datePublished: Fri Oct 11 2024 06:47:54 GMT+0000 (Coordinated Universal Time)
cuid: cm24d8kl8000309l6bjque75x
slug: argocd-email-alerts-a-step-by-step-guide-for-real-time-monitoring
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1728629117335/c3b2dc6c-e081-428c-a40b-9654b645ee9a.png

---

Hey there, Kubernetes aficionados! ğŸ‘‹ Remember when we talked about [ArgoCD being a DevOps engineer's best friend](https://devopswizard.hashnode.dev/argocd-a-devops-engineers-best-friend-real-world-guide)? Well, buckle up, because we're about to make that friendship even stronger with email alerts!

## The Problem: Silent Failures

Picture this: It's Friday night, you're out with friends, and suddenly your phone buzzes. It's not your buddy sharing another meme â€“ it's a customer complaining that the app is down. Ouch! ğŸ˜±

We've all been there, right? That's why we're going to set up ArgoCD notifications to give us a heads-up before things go south.

## The Solution: ArgoCD Notifications

ArgoCD notifications are like having a really attentive friend who's always watching your cluster and taps you on the shoulder when something's not quite right. Let's set it up!

### Step 1: Create the Secret

First, we need to create a secret with our email credentials. Don't worry, Kubernetes will keep it safe!

Create a file named `argocd-notifications-secret.yaml`:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: argocd-notifications-secret
  namespace: argocd
type: Opaque
stringData:
  email-username: <YOUR_EMAIL_USERNAME>
  email-password: <YOUR_EMAIL_PASSWORD>
```

Replace `<YOUR_EMAIL_USERNAME>` and `<YOUR_EMAIL_PASSWORD>` with your actual email credentials.

Now, let's apply this secret:

```bash
kubectl apply -f argocd-notifications-secret.yaml
```

### Step 2: Configure the Notifications

Next, we'll set up the notification configuration. This is where the magic happens!

Create a file named `argocd-notification-configmap.yaml`. Here's a breakdown of what we're doing:

1. **Email Service Configuration**: We're setting up the email service to use Office 365 SMTP.
    
2. **Templates**: We're creating templates for different scenarios like status changes, resource deletions, and scaling events.
    
3. **Triggers**: We're defining when to send these notifications.
    
4. **Subscriptions**: We're specifying who gets these notifications.
    

Here's a snippet of the ConfigMap:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  context: |
    argocdUrl: http://<YOUR_ARGOCD_URL>/argo
  
  service.email: |
    host: smtp.office365.com
    port: 587
    from: <YOUR_EMAIL_ADDRESS>
    username: $email-username
    password: $email-password
    format: text
  
  template.app-status-change: |
    email:
      subject: ğŸš¨ <YOUR_COMPANY_NAME> ArgoCD Alert - {{.app.metadata.name}} - Status Change
      body: |
        ğŸ”” Application Status Update ğŸ””
        
        ğŸ“ Application: {{.app.metadata.name}}
        ğŸŒ Namespace: {{.app.spec.destination.namespace}}
        ğŸ”— Git Commit: {{if .app.status.operationState.operation.sync.revision}}{{.app.status.operationState.operation.sync.revision | trunc 7}}{{else}}N/A{{end}}
        ğŸ”„ Sync Status: {{if eq .app.status.sync.status "Synced"}}âœ…{{else}}âš ï¸{{end}} {{.app.status.sync.status}}
        ğŸ’“ Health Status: {{if eq .app.status.health.status "Healthy"}}âœ…{{else}}âš ï¸{{end}} {{.app.status.health.status}}
        
        ğŸ“Š Detailed Status:
        {{range .app.status.resources}}
        - {{.kind}} {{.name}}: {{.status}} {{if .health}} (Health: {{if eq .health.status "Healthy"}}âœ…{{else}}âš ï¸{{end}} {{.health.status}}){{end}}
        {{- end}}
        
        {{if .app.status.conditions}}
        ğŸš© Conditions:
        {{range .app.status.conditions}}
        - {{.type}}: {{.message}}
        {{- end}}
        {{end}}
        
        ğŸ” View in ArgoCD: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
        
        This is an automated message from <YOUR_COMPANY_NAME> DevOps Team
        ğŸ•’ Timestamp: {{.time.Now | date "2006-01-02 15:04:05 UTC"}}

  template.resource-deleted: |
    email:
      subject: ğŸ—‘ï¸ <YOUR_COMPANY_NAME> ArgoCD Alert - {{.app.metadata.name}} - Resource Deletion
      body: |
        âš ï¸ Critical Resource Deleted âš ï¸
        
        ğŸ“ Application: {{.app.metadata.name}}
        ğŸŒ Namespace: {{.app.spec.destination.namespace}}
        ğŸ“¦ Deleted Resource: {{.resource.kind}}/{{.resource.name}}
        
        ğŸ“Š Current Application Resources:
        {{range .app.status.resources}}
        - {{.kind}} {{.name}}: {{.status}}{{if .health}} (Health: {{.health.status}}){{end}}
        {{- end}}
        
        {{if .app.status.conditions}}
        ğŸš© Application Conditions:
        {{range .app.status.conditions}}
        - {{.type}}: {{.message}}
        {{- end}}
        {{end}}
        
        ğŸ” View in ArgoCD: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
        
        This is an automated message from <YOUR_COMPANY_NAME> DevOps Team
        ğŸ•’ Timestamp: {{.time.Now | date "2006-01-02 15:04:05 UTC"}}

  template.resource-scaled: |
    email:
      subject: ğŸ“ˆ <YOUR_COMPANY_NAME> ArgoCD Alert - {{.app.metadata.name}} - Resource Scaled
      body: |
        ğŸ”¢ Resource Scaling Event ğŸ”¢
        
        ğŸ“ Application: {{.app.metadata.name}}
        ğŸŒ Namespace: {{.app.spec.destination.namespace}}
        ğŸ“¦ Scaled Resource: {{.resource.kind}}/{{.resource.name}}
        ğŸ”¢ Old Replicas: {{.resource.state.live.spec.replicas}}
        ğŸ”¢ New Replicas: {{.resource.state.target.spec.replicas}}
        
        ğŸ“Š Current Application Resources:
        {{range .app.status.resources}}
        - {{.kind}} {{.name}}: {{.status}}{{if .health}} (Health: {{.health.status}}){{end}}
        {{- end}}
        
        {{if .app.status.conditions}}
        ğŸš© Application Conditions:
        {{range .app.status.conditions}}
        - {{.type}}: {{.message}}
        {{- end}}
        {{end}}
        
        ğŸ” View in ArgoCD: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
        
        This is an automated message from <YOUR_COMPANY_NAME> DevOps Team
        ğŸ•’ Timestamp: {{.time.Now | date "2006-01-02 15:04:05 UTC"}}

  template.pod-crash-loop: |
    email:
      subject: ğŸ”„ <YOUR_COMPANY_NAME> ArgoCD Alert - {{.app.metadata.name}} - Pod CrashLoopBackOff
      body: |
        ğŸš¨ Pod CrashLoopBackOff Detected ğŸš¨
        
        ğŸ“ Application: {{.app.metadata.name}}
        ğŸŒ Namespace: {{.app.spec.destination.namespace}}
        ğŸ“¦ Affected Pod: {{.resource.name}}
        
        ğŸ“Š Pod Details:
        - Status: {{.resource.status.phase}}
        - Restart Count: {{index .resource.status.containerStatuses 0 "restartCount"}}
        - Last State Exit Code: {{index .resource.status.containerStatuses 0 "lastState" "terminated" "exitCode"}}
        - Last State Reason: {{index .resource.status.containerStatuses 0 "lastState" "terminated" "reason"}}
        
        ğŸ” View in ArgoCD: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}
        
        This is an automated message from <YOUR_COMPANY_NAME> DevOps Team
        ğŸ•’ Timestamp: {{.time.Now | date "2006-01-02 15:04:05 UTC"}}

  trigger.on-sync-status-change: |
    - when: app.status.sync.status != 'Synced'
      send: [app-status-change]

  trigger.on-health-status-change: |
    - when: app.status.health.status != 'Healthy'
      send: [app-status-change]

  trigger.on-operation-running: |
    - when: app.status.operationState.phase in ['Running']
      send: [app-status-change]

  trigger.on-operation-error: |
    - when: app.status.operationState.phase in ['Error']
      send: [app-status-change]

  trigger.on-resource-deleted: |
    - when: |
        resource.state.live == null and
        resource.state.target != null
      send: [resource-deleted]

  trigger.on-resource-scaled: |
    - when: |
        resource.state.live != null and
        resource.state.target != null and
        resource.state.live.spec.replicas != resource.state.target.spec.replicas
      send: [resource-scaled]

  trigger.on-pod-crash-loop: |
    - when: |
        resource.state.live != null and
        resource.state.live.status.phase == 'Running' and
        any(resource.state.live.status.containerStatuses, {.state.waiting.reason == 'CrashLoopBackOff'})
      send: [pod-crash-loop]

  subscriptions: |
    - recipients:
      - email:<YOUR_EMAIL_ADDRESS>
      triggers:
      - on-sync-status-change
      - on-health-status-change
      - on-operation-running
      - on-operation-error
      - on-resource-deleted
      - on-resource-scaled
      - on-pod-crash-loop
```

Replace `<YOUR_ARGOCD_URL>` and `<YOUR_EMAIL_ADDRESS>` with your actual ArgoCD URL and email address.

### Step 3: Apply the Configuration

Now, let's apply this configuration:

```bash
kubectl apply -f argocd-notification-configmap.yaml
```

### Step 4: Restart the Notifications Controller

For the changes to take effect, we need to restart the notifications controller:

```bash
kubectl rollout restart deployment argocd-notifications-controller -n argocd
```

### Step 5: Verify It's Working

To make sure everything's set up correctly, let's check the logs:

```bash
kubectl logs -l app.kubernetes.io/name=argocd-notifications-controller -n argocd -f
```

If you see any errors, don't panic! Double-check your configuration and make sure all the placeholders are replaced with your actual information.

## The Result: Peace of Mind

Once everything's set up, you'll start receiving emails like this:

```bash
ğŸ”” Application Status Update ğŸ””
ğŸ“ Application: myapp
ğŸŒ Namespace: production
ğŸ”— Git Commit: 3236e17
ğŸ”„ Sync Status: âœ… Synced
ğŸ’“ Health Status: âš ï¸ Progressing

ğŸ“Š Detailed Status:
- ConfigMap myapp-config: Synced
- Service myapp-service: Synced (Health: Healthy)
- Deployment myapp-deployment: Synced (Health: Progressing)
- HorizontalPodAutoscaler myapp-hpa: Synced (Health: Healthy)
- Ingress myapp-ingress: Synced (Health: Healthy)

ğŸ” View in ArgoCD: http://<YOUR_ARGOCD_URL>/argo/applications/myapp

This is an automated message from myapp DevOps Team
ğŸ•’ Timestamp: 2024-10-10 07:34:28 IST
```

## Pro Tips

1. **Customize Your Templates**: The templates we've set up are just the beginning. Feel free to customize them to fit your team's needs. Maybe add some GIFs for critical alerts? ğŸ¬
    
2. **Use Different Channels**: While we've set up email alerts, ArgoCD supports other channels too, like Slack or Microsoft Teams. Mix and match for the best results!
    
3. **Set Up Escalation**: For critical apps, consider setting up an escalation policy. If the first alert isn't acknowledged, send it to the next person in line.
    
4. **Regular Review**: Set a calendar reminder to review your notification setup every few months. As your infrastructure evolves, so should your alerts.
    

## Wrapping Up

There you have it, folks! With these ArgoCD notifications, you're not just deploying like a pro â€“ you're monitoring like one too. No more silent failures, no more weekend surprises. Just smooth sailing and happy customers. ğŸš¢

Remember, the key to great DevOps isn't just about automating deployments â€“ it's about staying ahead of problems. With ArgoCD and these notifications, you're doing just that.

Now, go forth and notify! And hey, if you set this up and it saves your bacon, drop me a line. I love a good DevOps success story! ğŸ¥“

Happy ArgoCD-ing! ğŸš€